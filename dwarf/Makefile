CXXFLAGS+=-g -O2 -Werror
override CXXFLAGS+=-std=c++0x -Wall

SRCS := dwarf.cc cursor.cc die.cc value.cc abbrev.cc \
	expr.cc attrs.cc die_str_map.cc elf.cc to_string.cc
HDRS := dwarf++.hh data.hh internal.hh
CLEAN :=

libdwarf++.a: $(SRCS:.cc=.o)
	ar rcs $@ $^
CLEAN += libdwarf++.a $(SRCS:.cc=.o)

$(SRCS:.cc=.o): $(HDRS)

to_string.cc: enum-print.py dwarf++.hh data.hh Makefile
	@echo "// Automatically generated by make at $$(date)" > to_string.cc
	@echo "// DO NOT EDIT" >> to_string.cc
	@echo >> to_string.cc
	@echo '#include "internal.hh"' >> to_string.cc
	@echo >> to_string.cc
	@echo 'DWARFPP_BEGIN_NAMESPACE' >> to_string.cc
	@echo >> to_string.cc
	python enum-print.py < dwarf++.hh >> to_string.cc
	python enum-print.py -s _ -u --hex -x hi_user -x lo_user < data.hh >> to_string.cc
	@echo 'DWARFPP_END_NAMESPACE' >> to_string.cc
CLEAN += to_string.cc

clean:
	rm -f $(CLEAN)

.DELETE_ON_ERROR:
